# ================================================================
# INGRESS - Expose ứng dụng ra internet
# ================================================================
# 
# YÊU CẦU:
# - Kubernetes cluster phải có Ingress Controller (nginx, traefik, etc.)
# - Có domain name trỏ về cluster
# - Có SSL certificate (Let's Encrypt hoặc tự tạo)
# 
# ================================================================

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: quychung-ingress
  namespace: quychung
  annotations:
    # Nginx Ingress Controller
    kubernetes.io/ingress.class: nginx
    
    # SSL/TLS với Let's Encrypt
    cert-manager.io/cluster-issuer: letsencrypt-prod
    
    # CORS
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    
    # WebSocket support (nếu cần)
    nginx.ingress.kubernetes.io/websocket-services: backend-service
    
    # Request size limit (cho upload)
    nginx.ingress.kubernetes.io/proxy-body-size: 10m
    
    # Rate limiting
    nginx.ingress.kubernetes.io/rate-limit: "100"
spec:
  tls:
  - hosts:
    - your-domain.com
    - api.your-domain.com
    secretName: quychung-tls-cert
    # Cert-manager tự động tạo secret này
  
  rules:
  # ===== Frontend =====
  - host: your-domain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 3000
  
  # ===== Backend API =====
  - host: api.your-domain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 8080

---
# ================================================================
# ALTERNATIVE: LoadBalancer Service (nếu không dùng Ingress)
# ================================================================
# Uncomment nếu cluster không có Ingress Controller
# Sẽ tạo External LoadBalancer (GCP, AWS, Azure)
# 
# apiVersion: v1
# kind: Service
# metadata:
#   name: frontend-loadbalancer
#   namespace: quychung
# spec:
#   type: LoadBalancer
#   selector:
#     app: frontend
#   ports:
#   - port: 80
#     targetPort: 3000
#     protocol: TCP
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: backend-loadbalancer
#   namespace: quychung
# spec:
#   type: LoadBalancer
#   selector:
#     app: backend
#   ports:
#   - port: 80
#     targetPort: 8080
#     protocol: TCP
